version: 1
frontend:
  phases:
    preBuild:
      commands:
        - 'echo "Using system Node"'
        - 'node -v'
        - 'npm -v'
        - 'npm ci'
    build:
      commands:
        - 'echo set locale'
        - 'export LANG="C.UTF-8"'
        - 'export LC_ALL="C.UTF-8"'
        - 'echo "Ensure bundler"'
        - 'echo Ruby version'
        - 'ruby -v'
        - 'gem install bundler --no-document'
        - 'bundle config set path vendor/bundle'
        - 'bundle install'
        - 'echo "npm run build"'
        - 'npm run build'
        - 'echo "jekyll build"'
        - 'bundle exec jekyll build --config _config.yml'
        - 'echo "site listing"'
        - 'ls -la _site || true'
  artifacts:
    baseDirectory: _site
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - vendor/bundle/**/*

